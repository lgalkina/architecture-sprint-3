# Базовая настройка

## Запуск minikube

[Инструкция по установке](https://minikube.sigs.k8s.io/docs/start/)

```bash
minikube start
```

## Добавление токена авторизации GitHub

[Получение токена](https://github.com/settings/tokens/new)

```bash
kubectl create secret docker-registry ghcr --docker-server=https://ghcr.io --docker-username=<github_username> --docker-password=<github_token> -n default
```

## Установка API GW kusk

[Install Kusk CLI](https://docs.kusk.io/getting-started/install-kusk-cli)

```bash
kusk cluster install
```

## Смена адреса образа в helm chart

После того как вы сделали форк репозитория и у вас в репозитории отработал GitHub Action. Вам нужно получить адрес образа <https://github.com/><github_username>/architecture-sprint-3/pkgs/container/architecture-sprint-3

Он выглядит таким образом
```ghcr.io/<github_username>/architecture-sprint-3:latest```

Замените адрес образа в файле `helm/smart-home-monolith/values.yaml` на полученный файл:

```yaml
image:
  repository: ghcr.io/<github_username>/architecture-sprint-3
  tag: latest
```

## Настройка terraform

[Установите Terraform](https://yandex.cloud/ru/docs/tutorials/infrastructure-management/terraform-quickstart#install-terraform)

Создайте файл ~/.terraformrc

```hcl
provider_installation {
  network_mirror {
    url = "https://terraform-mirror.yandexcloud.net/"
    include = ["registry.terraform.io/*/*"]
  }
  direct {
    exclude = ["registry.terraform.io/*/*"]
  }
}
```

## Применяем terraform конфигурацию

```bash
cd terraform
terraform init
terraform apply
```

## Настройка API GW

```bash
kusk deploy -i api.yaml
```

## Проверяем работоспособность

```bash
kubectl port-forward svc/kusk-gateway-envoy-fleet -n kusk-system 8080:80
curl localhost:8080/hello
```

## Delete minikube

```bash
minikube delete
```

# Анализ монолитного приложения

## Функциональность монолитного приложения

1. Управление отоплением:
   - Пользователи могут удалённо включать/выключать отопление в своих домах.
   - Пользователи могут устанавливать желаемую температуру.
   - Система автоматически поддерживает заданную температуру, регулируя подачу тепла.
2. Мониторинг температуры:
   - Система получает данные о температуре с датчиков, установленных в домах.
   - Пользователи могут просматривать текущую температуру в своих домах через веб-интерфейс.

## Архитектура монолитного приложения

- Язык программирования: Java
- База данных: PostgreSQL
- Архитектура: Монолитная, все компоненты системы (обработка запросов, бизнес-логика, работа с данными) находятся в рамках одного приложения.
- Взаимодействие: Синхронное, запросы обрабатываются последовательно.
- Масштабируемость: Ограничена, так как монолит сложно масштабировать по частям.
- Развертывание: Требует остановки всего приложения.

## Сильные и слабые стороны монолитного приложения

1. Сильные стороны:

   - Простота разработки - проще в разработке и тестировании, так как все компоненты находятся в одном месте.
   - Простота развёртывания - требуется развернуть только один артефакт.
   - Упрощённое управление зависимостями - все компоненты находятся в одном проекте. 
   - Высокая производительность: все компоненты находятся в одном процессе.
   
2. Слабые стороны:
   - Трудности с масштабированием - масштабировать придётся всё приложение целиком, даже если нагрузки не выдерживает только одна функциональность.
   - Неустойчивость к отказам - один сбой может привести к отказу всего приложения, что делает его менее устойчивым к отказам. 
   - Необходимость перезапуска - для внесения изменений или обновлений требуется перезапуск всего приложения, что может привести к простоям.
   - Длительные циклы разработки и развёртывания - изменения в одном компоненте могут потребовать пересборки и переразвёртывания всего приложения, что увеличивает время разработки и развёртывания.
   - Высокий риск ошибок - изменения в одном компоненте могут непредсказуемо повлиять на другие компоненты, что увеличивает риск ошибок и дефектов.

## Домены и границы контекстов

1. Домен "Управление Устройствами":
    - Поддомен "Управление Отоплением":
        - Включение/выключение отопления.
        - Установка желаемой температуры.
        - Автоматическое поддержание заданной температуры.
    - Поддомен "Управление Датчиками":
        - Установка/замена датчика.
        - Подключение/отключение датчика.

2. Домен "Мониторинг Температуры":
   - Поддомен "Сбор Данных":
        - Получение данных о температуре с датчиков.
   - Поддомен "Отображение Данных":
        - Отображение текущей температуры в веб-интерфейсе.

## Диаграммы 

1. С4:
    - [context.puml](./diagrams/context.puml) 
    - [container.puml](./diagrams/container.puml) 
    - [component.puml](./diagrams/component.puml) 
    - [code_classes.puml](./diagrams/code_classes.puml) - вариант для heating controller
2. ER:
    - [er.puml](./diagrams/er.puml)

## Документация

Для взаимодействия с "Heating Control Service" (Управление устройствами) будет использоваться REST, 
API задокументировано с помощью OpenAPI: [device_api.yaml](./docs/device_api.yaml)

Для взаимодействия с "Sensor Management Service" (Телеметрия) будет использоваться kafka,
API задокументировано с помощью AsyncAPI: [telemetry_api.yaml](./docs/telemetry_api.yaml)


